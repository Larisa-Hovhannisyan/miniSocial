<h2>Feed</h2>

<% if (!posts || posts.length === 0) { %>
  <p>No posts yet</p>
<% } else { %>
  <ul class="posts">
    <% posts.forEach(post => { %>
      <li class="post-card">
        <div class="meta">
          <strong><%= post.author?.username || "Unknown" %></strong>
          <small><%= new Date(post.createdAt).toLocaleString() %></small>
        </div>

        <p class="post-text"><%= post.text %></p>

        <% if (post.images && post.images.length) { %>
          <div class="slider">
            <% post.images.forEach((img, i) => { %>
              <img 
                src="<%= img %>" 
                alt="post image" 
                class="slide <%= i === 0 ? 'active' : '' %>" 
              />
            <% }) %>
            <% if (post.images.length > 1) { %>
              <button class="prev">&#10094;</button>
              <button class="next">&#10095;</button>
            <% } %>
          </div>
        <% } %>

        <div class="actions">
          <form method="POST" action="/posts/<%= post._id %>/like">
            <button type="submit" class="btn-like">
              Like (<%= post.likes %>)
            </button>
          </form>
        </div>
      </li>
    <% }) %>
  </ul>
<% } %>

<script>
document.querySelectorAll('.slider').forEach(slider => {
  const slides = slider.querySelectorAll('.slide');
  let index = 0;

  const showSlide = i => {
    slides.forEach(s => s.classList.remove('active'));
    slides[i].classList.add('active');
  };

  const prev = slider.querySelector('.prev');
  const next = slider.querySelector('.next');

  if (prev && next) {
    prev.onclick = () => {
      index = (index - 1 + slides.length) % slides.length;
      showSlide(index);
    };
    next.onclick = () => {
      index = (index + 1) % slides.length;
      showSlide(index);
    };
  }
});
</script>

